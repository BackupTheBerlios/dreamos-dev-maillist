<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dreamos-dev] r11 - in trunk: . boot hardware include/mem mem
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dreamos-dev/2008-July/index.html" >
   <LINK REL="made" HREF="mailto:dreamos-dev%40lists.berlios.de?Subject=Re%3A%20%5BDreamos-dev%5D%20r11%20-%20in%20trunk%3A%20.%20boot%20hardware%20include/mem%20mem&In-Reply-To=%3C200807132203.m6DM3sLV013553%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000010.html">
   <LINK REL="Next"  HREF="000012.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dreamos-dev] r11 - in trunk: . boot hardware include/mem mem</H1>
    <B>finarfin at BerliOS</B> 
    <A HREF="mailto:dreamos-dev%40lists.berlios.de?Subject=Re%3A%20%5BDreamos-dev%5D%20r11%20-%20in%20trunk%3A%20.%20boot%20hardware%20include/mem%20mem&In-Reply-To=%3C200807132203.m6DM3sLV013553%40sheep.berlios.de%3E"
       TITLE="[Dreamos-dev] r11 - in trunk: . boot hardware include/mem mem">finarfin at mail.berlios.de
       </A><BR>
    <I>Mon Jul 14 00:03:54 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000010.html">[Dreamos-dev] r10 - in trunk: . drivers hardware mem processore
</A></li>
        <LI>Next message: <A HREF="000012.html">[Dreamos-dev] r12 - in trunk: . include include/mem include/shell	mem processore shell system
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11">[ date ]</a>
              <a href="thread.html#11">[ thread ]</a>
              <a href="subject.html#11">[ subject ]</a>
              <a href="author.html#11">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: finarfin
Date: 2008-07-14 00:03:52 +0200 (Mon, 14 Jul 2008)
New Revision: 11

Added:
   trunk/include/mem/kheap.h
   trunk/mem/kheap.c
Modified:
   trunk/.bochsrc
   trunk/Makefile
   trunk/bl.img
   trunk/boot/multicatcher.S
   trunk/dreamos.img
   trunk/hardware/8253.c
   trunk/kernel.c
   trunk/kernel.lds
   trunk/kernel.map
Log:
Aggiunti files:
 * include/mem/kheap.h
 * mem/kheap.c
Aggiornato il Makefile
Aggiunto l'EOI all'handler del PIT.
Modificato il file .bochsrc con 64mb di ram.
Modificato lo script kernel.lds


Modified: trunk/.bochsrc
===================================================================
--- trunk/.bochsrc	2008-07-06 15:19:25 UTC (rev 10)
+++ trunk/.bochsrc	2008-07-13 22:03:52 UTC (rev 11)
@@ -87,9 +87,9 @@
 #=======================================================================
 #megs: 256
 #megs: 128
-#megs: 64
+megs: 64
 #megs: 32
-megs: 16
+#megs: 16
 #megs: 8
 
 #=======================================================================
@@ -428,7 +428,7 @@
 #   parport2: enabled=1, file=&quot;/dev/lp0&quot;
 #   parport1: enabled=0
 #=======================================================================
-#parport1: enabled=1, file=&quot;parport.out&quot;
+parport1: enabled=1, file=&quot;parport.out&quot;
 
 #=======================================================================
 # SB16:

Modified: trunk/Makefile
===================================================================
--- trunk/Makefile	2008-07-06 15:19:25 UTC (rev 10)
+++ trunk/Makefile	2008-07-13 22:03:52 UTC (rev 11)
@@ -1,5 +1,5 @@
 CFLAGS = -nostdlib -fomit-frame-pointer -fno-builtin -fno-stack-protector -Wall -march=i386 -I./include -I./include/io -I./include/drivers -I./include/libc -I./include/processore -I./include/hardware -I./include/mem -I./include/system -I./include/shell
-OBJ = kernel.o io/video.o drivers/keyboard.o libc/ctype.o libc/string.o io/io.o libc/stdio.o hardware/cpuid.o hardware/keyboard.o processore/gdt.o processore/idt.o processore/handlers.o hardware/pic8259.o mem/fismem.o mem/paging.o system/syscall.o hardware/8253.o shell/shell.o
+OBJ = kernel.o io/video.o drivers/keyboard.o libc/ctype.o libc/string.o io/io.o libc/stdio.o hardware/cpuid.o hardware/keyboard.o processore/gdt.o processore/idt.o processore/handlers.o hardware/pic8259.o mem/fismem.o mem/paging.o mem/kheap.o system/syscall.o hardware/8253.o shell/shell.o
 
 dreamos.img: bl.img kernel.bin
 	mv kernel.bin dreamos.img
@@ -24,6 +24,7 @@
 libc/string.o : libc/string.c
 mem/fismem.o : mem/fismem.c
 mem/paging.o : mem/paging.c
+mem/kheap.o : mem/kheap.c
 drivers/keyboard.o : drivers/keyboard.c
 system/syscall.o : system/syscall.c
 hardware/8253.o : hardware/8253.c

Modified: trunk/bl.img
===================================================================
(Binary files differ)

Modified: trunk/boot/multicatcher.S
===================================================================
--- trunk/boot/multicatcher.S	2008-07-06 15:19:25 UTC (rev 10)
+++ trunk/boot/multicatcher.S	2008-07-13 22:03:52 UTC (rev 11)
@@ -17,6 +17,9 @@
 [BITS 32]
 
 [GLOBAL mboot]
+[EXTERN code]                   ; Start of the '.text' section.
+[EXTERN bss]                    ; Start of the .bss section.
+[EXTERN end]                    ; End of the last loadable section.
 
 mboot:
   dd  MBOOT_HEADER_MAGIC
@@ -24,6 +27,9 @@
   dd  MBOOT_CHECKSUM            ; Check the other values
    
   dd  mboot
+  dd  code                    ; Start of kernel '.text' (code) section.
+  dd  bss                     ; End of kernel '.data' section.
+  dd  end                     ; End of kernel.
   dd  start                     ; Kernel start point
 
 [GLOBAL start]

Modified: trunk/dreamos.img
===================================================================
(Binary files differ)

Modified: trunk/hardware/8253.c
===================================================================
--- trunk/hardware/8253.c	2008-07-06 15:19:25 UTC (rev 10)
+++ trunk/hardware/8253.c	2008-07-13 22:03:52 UTC (rev 11)
@@ -27,7 +27,7 @@
 {
     if (++ticks % 100 == 0) {
 	ticks = 0;
-	if (++seconds &gt; 864000)
+	if (++seconds &gt; 86400)
 	  seconds = 0;     
     }
     

Added: trunk/include/mem/kheap.h
===================================================================
--- trunk/include/mem/kheap.h	2008-07-06 15:19:25 UTC (rev 10)
+++ trunk/include/mem/kheap.h	2008-07-13 22:03:52 UTC (rev 11)
@@ -0,0 +1,32 @@
+/***************************************************************************
+ *            kheap.h
+ *
+ *  Sat Mar 31 07:47:17 2007
+ *  Copyright  2007  Ivan Gualandri
+ *  Email
+ ****************************************************************************/
+
+/*
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+ */
+
+#ifndef KHEAP_H
+#define KHEAP_H
+
+extern unsigned int address_cur;
+
+unsigned int _kmalloc(int);
+
+#endif
\ No newline at end of file

Modified: trunk/kernel.c
===================================================================
--- trunk/kernel.c	2008-07-06 15:19:25 UTC (rev 10)
+++ trunk/kernel.c	2008-07-13 22:03:52 UTC (rev 11)
@@ -50,8 +50,8 @@
 }
 
 int main_loop(struct multiboot_info *boot_info)
-{
-    int a;
+{    
+
     _kclear();
 
     _kcolor('\012');
@@ -70,32 +70,37 @@
     outportb(0xFF, MASTER_PORT_1);
     outportb(0xFF, SLAVE_PORT_1);
     _kputs(LNG_IDT);
+
     asm(&quot;cli&quot;);   
     init_idt();
     _kprintOK();
-    calcola_memoria();
-    init_mem();
+    
+    calcola_memoria();    
+    init_mem();    
     _kputs(LNG_PIC8259);
     init_IRQ();
     asm(&quot;sti&quot;);
     _kprintOK();   
+    printf(&quot;End: %d\n&quot;, end);
     init_paging();    
-    get_cpuid();
-//     init_mem();
+
     printf(LNG_PIT8253);
     configure_PIT ();    
     _kprintOK();
+
     asm (&quot;movl $0, %eax\n&quot;
      &quot;movl $35, %ebx\n&quot;
      &quot;int $80&quot;);
-    printf(&quot;\n&quot;);
     printf(&quot;\nMemory (upper) amount-&gt; %d kb \n&quot;, boot_info-&gt;mem_upper);
+    get_cpuid();    
+    printf(&quot;\n&quot;);    
     printf(&quot;----\n&quot;);
     printf(&quot;Loading the shell..\n&quot;);
     printf(&quot;[+] Loading complete!!\n\n&quot;);    
-    printf(&quot;End: %d\n&quot;, end);
+    printf(&quot;End: %d Address: 0x%x\n&quot;, end, &amp;end);
+
     shell();
-    
+
 /*    if ( (shell()) != NULL)
     {	printf(&quot;[+] Loading compleate!!\n\n\n&quot;);	}
 */

Modified: trunk/kernel.lds
===================================================================
--- trunk/kernel.lds	2008-07-06 15:19:25 UTC (rev 10)
+++ trunk/kernel.lds	2008-07-13 22:03:52 UTC (rev 11)
@@ -4,12 +4,28 @@
 SECTIONS
 {
 
-    . = 0x100000;
+    .text 0x100000 :
+    {
+        code = .; _code = .; __code = .;
+        *(.text)
+        . = ALIGN(4096);
+    }
 
-    .text : { *(.text) }
-    .rodata : { *(.rodata) }
-    .data : { *(.data) *(.bss) *(COMMON) }
+    .data :
+    {
+        data = .; _data = .; __data = .;
+        *(.data)
+        *(.rodata)
+        . = ALIGN(4096);
+    }
 
+    .bss :
+    {
+        bss = .; _bss = .; __bss = .;
+        *(.bss)
+        . = ALIGN(4096);
+    }
+
     end = .; _end = .; __end = .;
 }
 

Modified: trunk/kernel.map
===================================================================
--- trunk/kernel.map	2008-07-06 15:19:25 UTC (rev 10)
+++ trunk/kernel.map	2008-07-13 22:03:52 UTC (rev 11)
@@ -16,6 +16,7 @@
 current_page_table  0x4               kernel.o
 master_cur_mask     0x1               hardware/pic8259.o
 bmp_elements        0x4               mem/fismem.o
+address_cur         0x4               mem/kheap.o
 binvp               0x3fc             io/video.o
 shareHandler        0x40              processore/handlers.o
 
@@ -26,252 +27,273 @@
 
 Linker script and memory map
 
-                0x0000000000100000                . = 0x100000
 
-.text           0x0000000000100000     0x3f19
+.text           0x0000000000100000     0x4000
+                0x0000000000100000                code = .
+                0x0000000000100000                _code = .
+                0x0000000000100000                __code = .
  *(.text)
- .text          0x0000000000100000       0x1d bl.img
+ .text          0x0000000000100000       0x29 bl.img
                 0x0000000000100000                mboot
-                0x0000000000100014                start
- *fill*         0x000000000010001d        0x3 00
- .text          0x0000000000100020      0x1c8 kernel.o
-                0x0000000000100034                main_loop
-                0x0000000000100020                _start
- .text          0x00000000001001e8      0x9d1 io/video.o
-                0x0000000000100b3e                _kscrolldown
-                0x00000000001001e8                _kputc
-                0x000000000010022a                _kputs
-                0x00000000001002c4                _kbackspace
-                0x0000000000100a13                _krotate_buffer
-                0x0000000000100401                _ksetcursauto
-                0x00000000001002ae                _kcolor
-                0x0000000000100511                _kdecbin
-                0x00000000001003d0                _ksetcursor
-                0x0000000000100463                _kprintOK
-                0x00000000001002da                _ktab
-                0x00000000001002e8                _kgoto
-                0x000000000010037d                _knewline
-                0x0000000000100a94                _kscrollup
-                0x0000000000100316                _kclear
-                0x00000000001004d7                _kgetline
-                0x0000000000100855                _kntos
-                0x000000000010048d                _kgetcolumn
-                0x00000000001005e8                _kntohex
-                0x0000000000100944                _kshiftAll
- *fill*         0x0000000000100bb9        0x3 00
- .text          0x0000000000100bbc      0x5e4 drivers/keyboard.o
-                0x000000000010101c                _ksetleds
-                0x0000000000101148                _kgetch
-                0x000000000010112f                keyboard_disable
-                0x0000000000101116                keyboard_enable
-                0x0000000000100bbc                keyboard_isr
- .text          0x00000000001011a0      0x19a libc/ctype.o
-                0x0000000000101270                islower
-                0x00000000001012c0                tolower
-                0x0000000000101238                isxdigit
-                0x0000000000101298                isupper
-                0x00000000001011c8                isalpha
-                0x00000000001011fe                isalnum
-                0x00000000001011a0                isdigit
-                0x00000000001012fd                toupper
- *fill*         0x000000000010133a        0x2 00
- .text          0x000000000010133c      0x2eb libc/string.o
-                0x00000000001014b7                strstr
-                0x000000000010133c                strncpy
-                0x0000000000101533                strtok
-                0x00000000001015bd                strncat
-                0x0000000000101446                strdup
-                0x0000000000101410                memset
-                0x000000000010139c                _kstrncmp
-                0x0000000000101375                strlen
-                0x0000000000101496                strchr
- *fill*         0x0000000000101627        0x1 00
- .text          0x0000000000101628       0x23 io/io.o
-                0x0000000000101628                inportb
-                0x0000000000101641                outportb
- *fill*         0x000000000010164b        0x1 00
- .text          0x000000000010164c      0x632 libc/stdio.o
-                0x000000000010164c                putchar
-                0x0000000000101756                printf
-                0x0000000000101b2a                gets
-                0x0000000000101b0f                getchar
-                0x0000000000101b9d                scanf
-                0x0000000000101666                atoi
- *fill*         0x0000000000101c7e        0x2 00
- .text          0x0000000000101c80      0x18c hardware/cpuid.o
-                0x0000000000101c80                get_cpuid
- .text          0x0000000000101e0c       0x67 hardware/keyboard.o
-                0x0000000000101e0c                keyboard_irq
- *fill*         0x0000000000101e73        0x1 00
- .text          0x0000000000101e74      0x1d0 processore/gdt.o
-                0x0000000000101f50                add_GDTseg
-                0x0000000000101e74                init_gdt
-                0x0000000000101ffb                set_gdtr
- .text          0x0000000000102044      0x65d processore/idt.o
-                0x0000000000102605                add_IDTseg
-                0x0000000000102379                init_idt
-                0x0000000000102679                set_idtr
- *fill*         0x00000000001026a1        0x3 00
- .text          0x00000000001026a4      0x38d processore/handlers.o
-                0x00000000001026a4                init_funcTable
-                0x000000000010299c                _irqinterrupt
-                0x0000000000102726                _globalException
-                0x0000000000102716                add_Interrupt
-                0x0000000000102a1c                _int_rsv
- *fill*         0x0000000000102a31        0x3 00
- .text          0x0000000000102a34      0x747 hardware/pic8259.o
-                0x0000000000102c65                init_IRQ
-                0x0000000000102da1                setup_IRQ
-                0x0000000000102fdc                disable_IRQ
-                0x00000000001030bc                add_IRQ_handler
-                0x0000000000102f08                enable_IRQ
-                0x000000000010308e                get_current_irq
- *fill*         0x000000000010317b        0x1 00
- .text          0x000000000010317c      0x628 mem/fismem.o
-                0x000000000010317c                init_mem
-                0x0000000000103240                request_pages
-                0x0000000000103600                add_memarea_element
-                0x0000000000103716                get_numpages
-                0x0000000000103710                get_memsize
-                0x000000000010373c                malloc
-                0x0000000000103729                get_bmpelements
-                0x000000000010339b                release_pages
-                0x00000000001036f4                calcola_memoria
-                0x000000000010377a                free
- .text          0x00000000001037a4      0x2ca mem/paging.o
-                0x00000000001038b2                create_pageTable
-                0x00000000001037a4                init_paging
-                0x00000000001039e1                get_pagedir_entry
-                0x000000000010389c                create_pageDir
-                0x0000000000103a28                load_pdbr
-                0x000000000010398f                set_pagetable_entry_ric
-                0x00000000001039fe                get_pagetable_entry
-                0x00000000001038c8                set_pagedir_entry
-                0x0000000000103909                set_pagedir_entry_ric
-                0x000000000010394e                set_pagetable_entry
- *fill*         0x0000000000103a6e        0x2 00
- .text          0x0000000000103a70       0xba system/syscall.o
-                0x0000000000103a70                sysputch
-                0x0000000000103a96                syscall_handler
- *fill*         0x0000000000103b2a        0x2 00
- .text          0x0000000000103b2c       0xfa hardware/8253.o
-                0x0000000000103bf7                sleep
-                0x0000000000103b2c                PIT_handler
-                0x0000000000103b97                configure_PIT
- *fill*         0x0000000000103c26        0x2 00
- .text          0x0000000000103c28      0x2f1 shell/shell.o
-                0x0000000000103c7c                info
-                0x0000000000103e2a                shell
-                0x0000000000103c66                poweroff
-                0x0000000000103c4f                help
-                0x0000000000103c28                logo
+                0x0000000000100020                start
+ *fill*         0x0000000000100029        0x3 00
+ .text          0x000000000010002c      0x1e3 kernel.o
+                0x0000000000100040                main_loop
+                0x000000000010002c                _start
+ *fill*         0x000000000010020f        0x1 00
+ .text          0x0000000000100210      0x9d1 io/video.o
+                0x0000000000100b66                _kscrolldown
+                0x0000000000100210                _kputc
+                0x0000000000100252                _kputs
+                0x00000000001002ec                _kbackspace
+                0x0000000000100a3b                _krotate_buffer
+                0x0000000000100429                _ksetcursauto
+                0x00000000001002d6                _kcolor
+                0x0000000000100539                _kdecbin
+                0x00000000001003f8                _ksetcursor
+                0x000000000010048b                _kprintOK
+                0x0000000000100302                _ktab
+                0x0000000000100310                _kgoto
+                0x00000000001003a5                _knewline
+                0x0000000000100abc                _kscrollup
+                0x000000000010033e                _kclear
+                0x00000000001004ff                _kgetline
+                0x000000000010087d                _kntos
+                0x00000000001004b5                _kgetcolumn
+                0x0000000000100610                _kntohex
+                0x000000000010096c                _kshiftAll
+ *fill*         0x0000000000100be1        0x3 00
+ .text          0x0000000000100be4      0x5e4 drivers/keyboard.o
+                0x0000000000101044                _ksetleds
+                0x0000000000101170                _kgetch
+                0x0000000000101157                keyboard_disable
+                0x000000000010113e                keyboard_enable
+                0x0000000000100be4                keyboard_isr
+ .text          0x00000000001011c8      0x19a libc/ctype.o
+                0x0000000000101298                islower
+                0x00000000001012e8                tolower
+                0x0000000000101260                isxdigit
+                0x00000000001012c0                isupper
+                0x00000000001011f0                isalpha
+                0x0000000000101226                isalnum
+                0x00000000001011c8                isdigit
+                0x0000000000101325                toupper
+ *fill*         0x0000000000101362        0x2 00
+ .text          0x0000000000101364      0x2eb libc/string.o
+                0x00000000001014df                strstr
+                0x0000000000101364                strncpy
+                0x000000000010155b                strtok
+                0x00000000001015e5                strncat
+                0x000000000010146e                strdup
+                0x0000000000101438                memset
+                0x00000000001013c4                _kstrncmp
+                0x000000000010139d                strlen
+                0x00000000001014be                strchr
+ *fill*         0x000000000010164f        0x1 00
+ .text          0x0000000000101650       0x23 io/io.o
+                0x0000000000101650                inportb
+                0x0000000000101669                outportb
+ *fill*         0x0000000000101673        0x1 00
+ .text          0x0000000000101674      0x632 libc/stdio.o
+                0x0000000000101674                putchar
+                0x000000000010177e                printf
+                0x0000000000101b52                gets
+                0x0000000000101b37                getchar
+                0x0000000000101bc5                scanf
+                0x000000000010168e                atoi
+ *fill*         0x0000000000101ca6        0x2 00
+ .text          0x0000000000101ca8      0x18c hardware/cpuid.o
+                0x0000000000101ca8                get_cpuid
+ .text          0x0000000000101e34       0x67 hardware/keyboard.o
+                0x0000000000101e34                keyboard_irq
+ *fill*         0x0000000000101e9b        0x1 00
+ .text          0x0000000000101e9c      0x1d0 processore/gdt.o
+                0x0000000000101f78                add_GDTseg
+                0x0000000000101e9c                init_gdt
+                0x0000000000102023                set_gdtr
+ .text          0x000000000010206c      0x65d processore/idt.o
+                0x000000000010262d                add_IDTseg
+                0x00000000001023a1                init_idt
+                0x00000000001026a1                set_idtr
+ *fill*         0x00000000001026c9        0x3 00
+ .text          0x00000000001026cc      0x38d processore/handlers.o
+                0x00000000001026cc                init_funcTable
+                0x00000000001029c4                _irqinterrupt
+                0x000000000010274e                _globalException
+                0x000000000010273e                add_Interrupt
+                0x0000000000102a44                _int_rsv
+ *fill*         0x0000000000102a59        0x3 00
+ .text          0x0000000000102a5c      0x747 hardware/pic8259.o
+                0x0000000000102c8d                init_IRQ
+                0x0000000000102dc9                setup_IRQ
+                0x0000000000103004                disable_IRQ
+                0x00000000001030e4                add_IRQ_handler
+                0x0000000000102f30                enable_IRQ
+                0x00000000001030b6                get_current_irq
+ *fill*         0x00000000001031a3        0x1 00
+ .text          0x00000000001031a4      0x628 mem/fismem.o
+                0x00000000001031a4                init_mem
+                0x0000000000103268                request_pages
+                0x0000000000103628                add_memarea_element
+                0x000000000010373e                get_numpages
+                0x0000000000103738                get_memsize
+                0x0000000000103764                malloc
+                0x0000000000103751                get_bmpelements
+                0x00000000001033c3                release_pages
+                0x000000000010371c                calcola_memoria
+                0x00000000001037a2                free
+ .text          0x00000000001037cc      0x2ca mem/paging.o
+                0x00000000001038da                create_pageTable
+                0x00000000001037cc                init_paging
+                0x0000000000103a09                get_pagedir_entry
+                0x00000000001038c4                create_pageDir
+                0x0000000000103a50                load_pdbr
+                0x00000000001039b7                set_pagetable_entry_ric
+                0x0000000000103a26                get_pagetable_entry
+                0x00000000001038f0                set_pagedir_entry
+                0x0000000000103931                set_pagedir_entry_ric
+                0x0000000000103976                set_pagetable_entry
+ *fill*         0x0000000000103a96        0x2 00
+ .text          0x0000000000103a98       0x17 mem/kheap.o
+                0x0000000000103a98                _kmalloc
+ *fill*         0x0000000000103aaf        0x1 00
+ .text          0x0000000000103ab0       0xba system/syscall.o
+                0x0000000000103ab0                sysputch
+                0x0000000000103ad6                syscall_handler
+ *fill*         0x0000000000103b6a        0x2 00
+ .text          0x0000000000103b6c       0xfa hardware/8253.o
+                0x0000000000103c37                sleep
+                0x0000000000103b6c                PIT_handler
+                0x0000000000103bd7                configure_PIT
+ *fill*         0x0000000000103c66        0x2 00
+ .text          0x0000000000103c68      0x2f1 shell/shell.o
+                0x0000000000103cbc                info
+                0x0000000000103e6a                shell
+                0x0000000000103ca6                poweroff
+                0x0000000000103c8f                help
+                0x0000000000103c68                logo
+                0x0000000000104000                . = ALIGN (0x1000)
+ *fill*         0x0000000000103f59       0xa7 00
 
-.rodata         0x0000000000103f1c      0x765
- *(.rodata)
- .rodata        0x0000000000103f1c       0xe2 kernel.o
- .rodata        0x0000000000103ffe       0x70 io/video.o
- .rodata        0x000000000010406e       0x10 drivers/keyboard.o
- .rodata        0x000000000010407e        0x2 libc/stdio.o
- .rodata        0x0000000000104080       0x3e hardware/cpuid.o
- .rodata        0x00000000001040be       0x1d hardware/keyboard.o
- *fill*         0x00000000001040db        0x1 00
- .rodata        0x00000000001040dc      0x23e processore/handlers.o
- *fill*         0x000000000010431a        0x2 00
- .rodata        0x000000000010431c       0x8a mem/fismem.o
- *fill*         0x00000000001043a6        0x2 00
- .rodata        0x00000000001043a8       0x23 mem/paging.o
- *fill*         0x00000000001043cb        0x1 00
- .rodata        0x00000000001043cc        0xc system/syscall.o
- .rodata        0x00000000001043d8      0x2a9 shell/shell.o
-
-.rel.dyn        0x0000000000104684        0x0 load address 0x0000000000104681
+.rel.dyn        0x0000000000104000        0x0
  .rel.text      0x0000000000000000        0x0 bl.img
 
-.data           0x00000000001046a0    0x3376c
+.data           0x0000000000104000     0x1000
+                0x0000000000104000                data = .
+                0x0000000000104000                _data = .
+                0x0000000000104000                __data = .
  *(.data)
- .data          0x00000000001046a0        0x0 kernel.o
- .data          0x00000000001046a0        0x9 io/video.o
-                0x00000000001046a4                VIDEO_PTR
-                0x00000000001046a8                VIDEO_CLR
-                0x00000000001046a0                VIDEO_MEM
- *fill*         0x00000000001046a9       0x17 00
- .data          0x00000000001046c0      0x2f8 drivers/keyboard.o
- .data          0x00000000001049b8        0x0 libc/ctype.o
- .data          0x00000000001049b8        0x0 libc/string.o
- .data          0x00000000001049b8        0x0 io/io.o
- .data          0x00000000001049b8        0x0 libc/stdio.o
- .data          0x00000000001049b8        0x0 hardware/cpuid.o
- .data          0x00000000001049b8        0x0 hardware/keyboard.o
- .data          0x00000000001049b8        0x0 processore/gdt.o
- .data          0x00000000001049b8        0x0 processore/idt.o
- .data          0x00000000001049b8        0x0 processore/handlers.o
- .data          0x00000000001049b8        0x0 hardware/pic8259.o
- .data          0x00000000001049b8        0xc mem/fismem.o
-                0x00000000001049b8                prova2
-                0x00000000001049bc                mem_info_root
-                0x00000000001049c0                mem_info
- .data          0x00000000001049c4        0x0 mem/paging.o
- .data          0x00000000001049c4        0x4 system/syscall.o
-                0x00000000001049c4                syscall_table
- .data          0x00000000001049c8        0x0 hardware/8253.o
- .data          0x00000000001049c8        0x0 shell/shell.o
+ .data          0x0000000000104000        0x0 kernel.o
+ .data          0x0000000000104000        0x9 io/video.o
+                0x0000000000104004                VIDEO_PTR
+                0x0000000000104008                VIDEO_CLR
+                0x0000000000104000                VIDEO_MEM
+ *fill*         0x0000000000104009       0x17 00
+ .data          0x0000000000104020      0x2f8 drivers/keyboard.o
+ .data          0x0000000000104318        0x0 libc/ctype.o
+ .data          0x0000000000104318        0x0 libc/string.o
+ .data          0x0000000000104318        0x0 io/io.o
+ .data          0x0000000000104318        0x0 libc/stdio.o
+ .data          0x0000000000104318        0x0 hardware/cpuid.o
+ .data          0x0000000000104318        0x0 hardware/keyboard.o
+ .data          0x0000000000104318        0x0 processore/gdt.o
+ .data          0x0000000000104318        0x0 processore/idt.o
+ .data          0x0000000000104318        0x0 processore/handlers.o
+ .data          0x0000000000104318        0x0 hardware/pic8259.o
+ .data          0x0000000000104318        0xc mem/fismem.o
+                0x0000000000104318                prova2
+                0x000000000010431c                mem_info_root
+                0x0000000000104320                mem_info
+ .data          0x0000000000104324        0x0 mem/paging.o
+ .data          0x0000000000104324        0x0 mem/kheap.o
+ .data          0x0000000000104324        0x4 system/syscall.o
+                0x0000000000104324                syscall_table
+ .data          0x0000000000104328        0x0 hardware/8253.o
+ .data          0x0000000000104328        0x0 shell/shell.o
+ *(.rodata)
+ .rodata        0x0000000000104328       0xf8 kernel.o
+ .rodata        0x0000000000104420       0x70 io/video.o
+ .rodata        0x0000000000104490       0x10 drivers/keyboard.o
+ .rodata        0x00000000001044a0        0x2 libc/stdio.o
+ .rodata        0x00000000001044a2       0x3e hardware/cpuid.o
+ .rodata        0x00000000001044e0       0x1d hardware/keyboard.o
+ *fill*         0x00000000001044fd        0x3 00
+ .rodata        0x0000000000104500      0x23e processore/handlers.o
+ *fill*         0x000000000010473e        0x2 00
+ .rodata        0x0000000000104740       0x8a mem/fismem.o
+ *fill*         0x00000000001047ca        0x2 00
+ .rodata        0x00000000001047cc       0x23 mem/paging.o
+ *fill*         0x00000000001047ef        0x1 00
+ .rodata        0x00000000001047f0        0xc system/syscall.o
+ .rodata        0x00000000001047fc      0x2a9 shell/shell.o
+                0x0000000000105000                . = ALIGN (0x1000)
+ *fill*         0x0000000000104aa5      0x55b 00
+
+.bss            0x0000000000105000    0x33ff0
+                0x0000000000105000                bss = .
+                0x0000000000105000                _bss = .
+                0x0000000000105000                __bss = .
  *(.bss)
- .bss           0x00000000001049c8        0x0 kernel.o
- .bss           0x00000000001049c8       0x10 io/video.o
-                0x00000000001049cc                is_shifted_once
-                0x00000000001049c8                is_scrolled
-                0x00000000001049d4                resulthex
-                0x00000000001049d0                binlen
- *fill*         0x00000000001049d8        0x8 00
- .bss           0x00000000001049e0      0x434 drivers/keyboard.o
- .bss           0x0000000000104e14        0x0 libc/ctype.o
- .bss           0x0000000000104e14        0x4 libc/string.o
- .bss           0x0000000000104e18        0x0 io/io.o
- .bss           0x0000000000104e18        0x0 libc/stdio.o
- .bss           0x0000000000104e18        0x0 hardware/cpuid.o
- .bss           0x0000000000104e18        0x0 hardware/keyboard.o
- .bss           0x0000000000104e18        0x0 processore/gdt.o
- .bss           0x0000000000104e18        0x0 processore/idt.o
- .bss           0x0000000000104e18        0x0 processore/handlers.o
- .bss           0x0000000000104e18        0x0 hardware/pic8259.o
- .bss           0x0000000000104e18        0x4 mem/fismem.o
-                0x0000000000104e18                num_pages
- .bss           0x0000000000104e1c        0x0 mem/paging.o
- .bss           0x0000000000104e1c        0x0 system/syscall.o
- .bss           0x0000000000104e1c        0x8 hardware/8253.o
- .bss           0x0000000000104e24        0x0 shell/shell.o
- *(COMMON)
- COMMON         0x0000000000104e24       0x10 kernel.o
-                0x0000000000104e24                cpu_vendor
-                0x0000000000104e30                current_page_table
- *fill*         0x0000000000104e34        0xc 00
- COMMON         0x0000000000104e40     0x233c io/video.o
-                0x0000000000104e40                downbuffer
-                0x0000000000105de0                upbuffer
-                0x0000000000106d80                binvp
- *fill*         0x000000000010717c        0x4 00
- COMMON         0x0000000000107180    0x10004 processore/gdt.o
-                0x0000000000107180                Gdt_Table
-                0x0000000000117180                current_pos
- *fill*         0x0000000000117184       0x1c 00
- COMMON         0x00000000001171a0      0xc00 processore/idt.o
-                0x00000000001171a0                IntTable
-                0x00000000001175a0                IDT_Table
- COMMON         0x0000000000117da0       0x40 processore/handlers.o
-                0x0000000000117da0                shareHandler
- COMMON         0x0000000000117de0        0x2 hardware/pic8259.o
-                0x0000000000117de0                slave_cur_mask
-                0x0000000000117de1                master_cur_mask
- *fill*         0x0000000000117de2       0x1e 00
- COMMON         0x0000000000117e00    0x20008 mem/fismem.o
-                0x0000000000117e00                mem_bitmap
-                0x0000000000137e00                tot_mem
-                0x0000000000137e04                bmp_elements
- COMMON         0x0000000000137e08        0x4 mem/paging.o
-                0x0000000000137e08                current_page_dir
-                0x0000000000137e0c                end = .
-                0x0000000000137e0c                _end = .
-                0x0000000000137e0c                __end = .
+ .bss           0x0000000000105000        0x0 kernel.o
+ .bss           0x0000000000105000       0x10 io/video.o
+                0x0000000000105004                is_shifted_once
+                0x0000000000105000                is_scrolled
+                0x000000000010500c                resulthex
+                0x0000000000105008                binlen
+ *fill*         0x0000000000105010       0x10 00
+ .bss           0x0000000000105020      0x434 drivers/keyboard.o
+ .bss           0x0000000000105454        0x0 libc/ctype.o
+ .bss           0x0000000000105454        0x4 libc/string.o
+ .bss           0x0000000000105458        0x0 io/io.o
+ .bss           0x0000000000105458        0x0 libc/stdio.o
+ .bss           0x0000000000105458        0x0 hardware/cpuid.o
+ .bss           0x0000000000105458        0x0 hardware/keyboard.o
+ .bss           0x0000000000105458        0x0 processore/gdt.o
+ .bss           0x0000000000105458        0x0 processore/idt.o
+ .bss           0x0000000000105458        0x0 processore/handlers.o
+ .bss           0x0000000000105458        0x0 hardware/pic8259.o
+ .bss           0x0000000000105458        0x4 mem/fismem.o
+                0x0000000000105458                num_pages
+ .bss           0x000000000010545c        0x0 mem/paging.o
+ .bss           0x000000000010545c        0x0 mem/kheap.o
+ .bss           0x000000000010545c        0x0 system/syscall.o
+ .bss           0x000000000010545c        0x8 hardware/8253.o
+ .bss           0x0000000000105464        0x0 shell/shell.o
+                0x0000000000106000                . = ALIGN (0x1000)
+ *fill*         0x0000000000105464      0xb9c 00
+ COMMON         0x0000000000106000       0x10 kernel.o
+                0x0000000000106000                cpu_vendor
+                0x000000000010600c                current_page_table
+ *fill*         0x0000000000106010       0x10 00
+ COMMON         0x0000000000106020     0x233c io/video.o
+                0x0000000000106020                downbuffer
+                0x0000000000106fc0                upbuffer
+                0x0000000000107f60                binvp
+ *fill*         0x000000000010835c        0x4 00
+ COMMON         0x0000000000108360    0x10004 processore/gdt.o
+                0x0000000000108360                Gdt_Table
+                0x0000000000118360                current_pos
+ *fill*         0x0000000000118364       0x1c 00
+ COMMON         0x0000000000118380      0xc00 processore/idt.o
+                0x0000000000118380                IntTable
+                0x0000000000118780                IDT_Table
+ COMMON         0x0000000000118f80       0x40 processore/handlers.o
+                0x0000000000118f80                shareHandler
+ COMMON         0x0000000000118fc0        0x2 hardware/pic8259.o
+                0x0000000000118fc0                slave_cur_mask
+                0x0000000000118fc1                master_cur_mask
+ *fill*         0x0000000000118fc2       0x1e 00
+ COMMON         0x0000000000118fe0    0x20008 mem/fismem.o
+                0x0000000000118fe0                mem_bitmap
+                0x0000000000138fe0                tot_mem
+                0x0000000000138fe4                bmp_elements
+ COMMON         0x0000000000138fe8        0x4 mem/paging.o
+                0x0000000000138fe8                current_page_dir
+ COMMON         0x0000000000138fec        0x4 mem/kheap.o
+                0x0000000000138fec                address_cur
+                0x0000000000138ff0                end = .
+                0x0000000000138ff0                _end = .
+                0x0000000000138ff0                __end = .
 LOAD bl.img
 LOAD kernel.o
 LOAD io/video.o
@@ -288,13 +310,14 @@
 LOAD hardware/pic8259.o
 LOAD mem/fismem.o
 LOAD mem/paging.o
+LOAD mem/kheap.o
 LOAD system/syscall.o
 LOAD hardware/8253.o
 LOAD shell/shell.o
 Address of section .text set to 0x100000
 OUTPUT(kernel.bin elf32-i386)
 
-.comment        0x0000000000000000      0x229
+.comment        0x0000000000000000      0x246
  .comment       0x0000000000000000       0x1f bl.img
  .comment       0x000000000000001f       0x1d kernel.o
  .comment       0x000000000000003c       0x1d io/video.o
@@ -311,9 +334,10 @@
  .comment       0x000000000000017b       0x1d hardware/pic8259.o
  .comment       0x0000000000000198       0x1d mem/fismem.o
  .comment       0x00000000000001b5       0x1d mem/paging.o
- .comment       0x00000000000001d2       0x1d system/syscall.o
- .comment       0x00000000000001ef       0x1d hardware/8253.o
- .comment       0x000000000000020c       0x1d shell/shell.o
+ .comment       0x00000000000001d2       0x1d mem/kheap.o
+ .comment       0x00000000000001ef       0x1d system/syscall.o
+ .comment       0x000000000000020c       0x1d hardware/8253.o
+ .comment       0x0000000000000229       0x1d shell/shell.o
 
 .note.GNU-stack
                 0x0000000000000000        0x0
@@ -348,6 +372,8 @@
  .note.GNU-stack
                 0x0000000000000000        0x0 mem/paging.o
  .note.GNU-stack
+                0x0000000000000000        0x0 mem/kheap.o
+ .note.GNU-stack
                 0x0000000000000000        0x0 system/syscall.o
  .note.GNU-stack
                 0x0000000000000000        0x0 hardware/8253.o

Added: trunk/mem/kheap.c
===================================================================
--- trunk/mem/kheap.c	2008-07-06 15:19:25 UTC (rev 10)
+++ trunk/mem/kheap.c	2008-07-13 22:03:52 UTC (rev 11)
@@ -0,0 +1,33 @@
+/***************************************************************************
+ *            kheap.c
+ *
+ *  Sat Mar 31 07:47:17 2007
+ *  Copyright  2007  Ivan Gualandri
+ *  Email
+ ****************************************************************************/
+
+/*
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+ */
+
+#include &lt;kernel.h&gt;
+#include &lt;kheap.h&gt;
+#include &lt;paging.h&gt;
+
+unsigned int address_cur;
+
+unsigned int _kmalloc(int size){
+    address_cur+=size;
+}
\ No newline at end of file


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000010.html">[Dreamos-dev] r10 - in trunk: . drivers hardware mem processore
</A></li>
	<LI>Next message: <A HREF="000012.html">[Dreamos-dev] r12 - in trunk: . include include/mem include/shell	mem processore shell system
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11">[ date ]</a>
              <a href="thread.html#11">[ thread ]</a>
              <a href="subject.html#11">[ subject ]</a>
              <a href="author.html#11">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dreamos-dev">More information about the Dreamos-dev
mailing list</a><br>
</body></html>
